import{R as i,V as H,r as S,a as R}from"./vendor.997f8905.js";const K=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}};K();const M=e=>{const t=e.item,n=(e.item.width-e.margin)/14,r=e.item.height/7;return i.createElement("a",{href:"https://calil.jp/book/"+e.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},t.cover?i.createElement("img",{src:t.cover,alt:t.title,"data-aspect":t.properties.aspect}):i.createElement("div",{className:"nocover"},i.createElement("div",{className:"bg"}),i.createElement("div",{className:"textCover"},t.height>100?i.createElement(i.Fragment,null,i.createElement("div",{className:"title",style:{fontSize:n+"px"}},t.title),i.createElement("div",{className:"author",style:{fontSize:n*.7+"px"}},t.author)):null)),e.sortKey&&t[e.sortKey]>0&&t.height>100?i.createElement("span",{className:"sortKey",style:{opacity:t[e.sortKey]/2+.1,fontSize:n+"px",width:r+"px",height:r+"px",right:r/4,bottom:r/4}},t[e.sortKey]):null)};function I(){const e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",document.body.appendChild(e);const t=document.createElement("div");e.appendChild(t);const n=e.offsetWidth-t.offsetWidth;return e.parentNode&&e.parentNode.removeChild(e),n}const N=(e,t,n,r,o)=>{const a=[];let l=0;const m=r*n;return e.some(u=>{const v=u.properties&&u.properties.aspect?u.properties.aspect:.666666,w=Math.floor(m*v)+o;if(l+w>t)return!0;u.height=m,u.width=w,a.push(u),l+=w}),a},T=(e,t,n)=>{const r=t.reduce((l,m)=>l+m.width,0),o=r/(r+n);t.some(l=>{l.width=Math.floor(l.width*o),l.height=Math.floor(l.height*o)});const a=t[0].height/e[0].height;return e.some(l=>{l.width=Math.floor(l.width*a),l.height=Math.floor(l.height*a)}),t.concat(e)},k=(e,t)=>{t&&e.sort(function(o,a){return o[t]<a[t]?1:o[t]>a[t]?-1:0});const n={},r=Math.floor(e.length/2);return n[r]=e[0],Array.from({length:r}).forEach((o,a)=>{e[a*2+1]&&(n[r-1-a]=e[a*2+1]),e[a*2+2]&&(n[r+1+a]=e[a*2+2])}),Object.values(n)},A=e=>{let t=e.items.map(s=>Object.assign({},s)),n=[],r=[],o=null,a={key:null,value:null},l=[],m=[],u=[];e.headerComponent&&(m.push({type:"header",component:e.headerComponent}),l.push(e.headerHeight));let f=0,v=t.slice(f,f+100);const w=e.width-e.padding*2-I();for(let s=0;v.length>0&&m.length<=e.rowCount;s++){const c=s%e.rowRatios.length,d=e.rowRatios[c];let h=N(v,w,d,e.itemHeight,e.itemMargin);const y=h.reduce((g,x)=>g+x.width,0),p=w/y;p<2&&h.length>1?h.some(g=>{g.width=Math.floor(g.width*p),g.height=Math.floor(g.height*p)}):u.length>0&&(h=T(h,u,y),m.pop(),l.pop()),e.sortKey&&(h=k(h,e.sortKey)),m.push(h),u=h;let E=[];h.forEach(g=>{E.push(g.height+e.itemMargin)}),l.push(Math.max(...E)),f+=h.length,v=t.slice(f,f+100)}e.footerComponent&&(m.push({type:"footer",component:e.footerComponent}),l.push(e.footerHeight)),n=m,r=l;const b=(s,c)=>{let d;n.some((p,E)=>{if(typeof p.type=="undefined"&&p.filter(g=>g[s]===c).length>0)return d=E,!0});let h=e.padding;r.some((p,E)=>{if(E===d)return!0;h+=p});const y=setInterval(()=>{if(o.firstElementChild.scrollTop>=h)return clearTimeout(y);o.firstElementChild.scrollTo(0,h)},1);setTimeout(()=>clearTimeout(y),1e3)};if(e.scrollTo&&e.scrollTo.value!==a.value){const{key:s,value:c}=e.scrollTo;setTimeout(()=>{b(s,c)},100),a=JSON.parse(JSON.stringify(e.scrollTo))}let C=0;return r.some((s,c)=>{C+=s}),i.createElement("div",{className:e.className?e.className:"hiradumi",ref:s=>o=s},i.createElement(H,{width:e.width,height:e.height,itemCount:n.length,itemSize:s=>r[s],estimatedItemSize:C/n.length,onScroll:s=>{if(!o)return;const c=o.firstElementChild;s.scrollTop=c.scrollTop,s.scrollBottom=c.scrollHeight-c.clientHeight-c.scrollTop,e.onScroll(s)},style:e.innerStyle},s=>{const c=n[s.index],d=JSON.parse(JSON.stringify(s.style));return d.display="flex",d.justifyContent="space-between",typeof c.type=="undefined"?(d.top=parseInt(s.style.top)+e.padding+"px",d.left=e.padding+"px",d.width=`calc(100% - ${e.padding*2}px)`,d.boxSizing="border-box",i.createElement("div",{className:"row",style:d,key:"row"},c.map((h,y)=>i.createElement("div",{key:"item"+y,className:"item",id:h.id,style:{display:"inline-block",width:h.width+"px",height:h.height+"px",margin:e.itemMargin/2+"px"}},(()=>e.itemComponent?i.createElement(e.itemComponent,{item:h,margin:e.itemMargin,sortKey:e.sortKey}):i.createElement(M,{item:h,margin:e.itemMargin,sortKey:e.sortKey}))())))):(d.top=parseInt(s.style.top)+e.padding+"px",d.marginTop=e.itemMargin/2,i.createElement("div",{className:"row",style:d},i.createElement(c.component,null)))}))};function z(e){var t=document.createElement("div"),n=document.createElement("pre");n.style.webkitUserSelect="auto",n.style.userSelect="auto",t.appendChild(n).textContent=e;var r=t.style;r.position="fixed",r.right="200%",document.body.appendChild(t),document.getSelection().selectAllChildren(t);var o=document.execCommand("copy");return document.body.removeChild(t),o}class F extends S.exports.Component{constructor(t){super(t)}setRowHeight(){let t=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach(n=>{n.value!==""?t.push(parseInt(n.value)):t.push(parseInt(n.placeholder))}),this.props.onChange({rowHeightList:t})}copy(){let t=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach(n=>{n.value!==""?t.push(n.value):t.push(parseFloat(n.placeholder))}),z(t.toString())}setSortKey(t){t.checked?this.props.onChange({sortKey:"term_popular_count"}):this.props.onChange({sortKey:null})}setRowFactors(){const t=[];Array.prototype.slice.call(document.querySelectorAll('input[type="number"]')).forEach(n=>{t.push(n.value)}),this.props.onChange({rowRatios:t})}render(){return i.createElement("div",{id:"settingsUI",style:{maxWidth:"1400px",margin:"0 auto",padding:"10px"}},i.createElement("div",null,i.createElement("label",{htmlFor:"itemHeight"},"itemHeight:"),i.createElement("input",{type:"range",id:"itemHeight",name:"width",min:"10",max:"600",value:this.props.itemHeight,onChange:t=>this.props.onChange({itemHeight:parseInt(t.target.value)})}),this.props.itemHeight,"\xA0",i.createElement("label",{htmlFor:"itemMargin"},"itemMargin:"),i.createElement("input",{type:"range",id:"itemMargin",name:"width",min:"0",max:"50",value:this.props.itemMargin,onChange:t=>this.props.onChange({itemMargin:parseInt(t.target.value)})}),this.props.itemMargin,"\xA0",i.createElement("label",{htmlFor:"rowCount"},"rowCount:"),i.createElement("input",{type:"range",id:"rowCount",name:"width",min:"1",max:"30",value:this.props.rowCount,onChange:t=>this.props.onChange({rowCount:parseInt(t.target.value)})}),this.props.rowCount,"\xA0\xA0",i.createElement("label",{htmlFor:"padding"},"padding:"),i.createElement("input",{type:"range",id:"padding",name:"width",min:"0",max:"50",value:this.props.padding,onChange:t=>this.props.onChange({padding:parseInt(t.target.value)})}),this.props.padding,"\xA0",i.createElement("label",{htmlFor:"sortKey"},"sortKey:"),i.createElement("input",{type:"checkbox",id:"sortKey",name:"sortKey",defaultChecked:!0,onChange:t=>this.setSortKey(t.target)})),i.createElement("br",null),i.createElement("div",null,i.createElement("label",null,"rowRatios:"),this.props.rowRatios&&this.props.rowRatios.map((t,n)=>i.createElement("input",{type:"number",placeholder:String(t),value:String(t),step:"0.1",className:"rowHeight",key:n,onChange:this.setRowFactors.bind(this),style:{width:"3rem"}})),i.createElement("button",{onClick:this.copy.bind(this)},"Copy")))}}const W=e=>{const t=e.item,n=(e.item.width-e.margin)/14,r=e.item.height/7;return i.createElement("a",{href:"https://calil.jp/book/"+e.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},t.cover?i.createElement("img",{src:t.cover,alt:t.title,"data-aspect":t.properties.aspect}):i.createElement("div",{className:"nocover"},i.createElement("div",{className:"bg"}),i.createElement("div",{className:"textCover"},t.height>100?i.createElement(i.Fragment,null,i.createElement("div",{className:"title",style:{fontSize:n+"px"}},t.title),i.createElement("div",{className:"author",style:{fontSize:n*.7+"px"}},t.author)):null)),e.sortKey&&t[e.sortKey]>0&&t.height>100?i.createElement("span",{className:"sortKey",style:{opacity:t[e.sortKey]/2+.1,fontSize:n+"px",width:r+"px",height:r+"px",right:r/4,bottom:r/4}},t[e.sortKey]):null)};class O extends S.exports.Component{constructor(t){super(t);this.state={items:t.items,itemHeight:200,width:100,height:0,padding:10,itemMargin:10,rowCount:1/0,sortKey:"term_popular_count",rowRatios:null,scrollTo:null,showHiradumi:!0}}componentDidMount(){document.body.clientWidth>767?this.setState({rowRatios:[1,.9,.8,.7]}):this.setState({rowRatios:[.97,.75,.65,.55]}),this.setState({width:window.innerWidth,height:window.innerHeight});const t=setInterval(()=>{this.settingUI&&(this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight}),clearInterval(t))},100);if(window.addEventListener("resize",()=>{this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight})}),location.hash){const n=location.hash.substr(1);this.setState({scrollTo:{key:"isbn",value:n}})}}onChange(t){"itemHeight"in t&&this.setState({showHiradumi:!1}),this.setState(t),"itemHeight"in t&&setTimeout(()=>{this.setState({showHiradumi:!0})},100)}render(){return this.state.items?i.createElement("div",null,this.state.rowRatios?i.createElement(i.Fragment,null,i.createElement("div",{ref:t=>this.settingUI=t},i.createElement(F,{itemHeight:this.state.itemHeight,width:this.state.width,padding:this.state.padding,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,sortKey:this.state.sortKey,onChange:this.onChange.bind(this)})),i.createElement("div",{style:{width:"100%",margin:"0 auto"}},this.state.showHiradumi?i.createElement(A,{width:this.state.width,height:this.state.height,items:this.state.items,padding:this.state.padding,itemHeight:this.state.itemHeight,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,itemComponent:W,className:"hiradumi",sortKey:this.state.sortKey,onScroll:t=>{},headerComponent:U,headerHeight:50,footerComponent:j,footerHeight:50,innerStyle:{},scrollTo:this.state.scrollTo}):null)):null):null}}const U=()=>i.createElement("header",null,"header"),j=()=>i.createElement("footer",null,"footer");fetch("https://bookdata-fair.calil.dev/all.json").then(e=>e.json()).then(e=>{R.render(i.createElement(i.StrictMode,null,i.createElement(O,{items:e})),document.getElementById("root"))});
