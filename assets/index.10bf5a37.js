var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,i,o)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o;"undefined"!=typeof require&&require;import{R as n,V as s,r as a,a as l}from"./vendor.997f8905.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const h=e=>{const t=e.item,i=(e.item.width-e.margin)/14,o=e.item.height/7;return n.createElement("a",{href:"https://calil.jp/book/"+e.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},t.cover?n.createElement("img",{src:t.cover,alt:t.title,"data-aspect":t.properties.aspect}):n.createElement("div",{className:"nocover"},n.createElement("div",{className:"bg"}),n.createElement("div",{className:"textCover"},t.height>100?n.createElement(n.Fragment,null,n.createElement("div",{className:"title",style:{fontSize:i+"px"}},t.title),n.createElement("div",{className:"author",style:{fontSize:.7*i+"px"}},t.author)):null)),e.sortKey&&t[e.sortKey]>0&&t.height>100?n.createElement("span",{className:"sortKey",style:{opacity:t[e.sortKey]/2+.1,fontSize:i+"px",width:o+"px",height:o+"px",right:o/4,bottom:o/4}},t[e.sortKey]):null)};const c=(e,t,i,o,r)=>{const n=[];let s=0;const a=o*i;return e.some((e=>{const i=e.properties&&e.properties.aspect?e.properties.aspect:.666666,o=Math.floor(a*i)+r;if(s+o>t)return!0;e.height=a,e.width=o,n.push(e),s+=o})),n},m=(e,t,i)=>{const o=t.reduce(((e,t)=>e+t.width),0),r=o/(o+i);t.some((e=>{e.width=Math.floor(e.width*r),e.height=Math.floor(e.height*r)}));const n=t[0].height/e[0].height;return e.some((e=>{e.width=Math.floor(e.width*n),e.height=Math.floor(e.height*n)})),t.concat(e)},p=(e,t)=>{t&&e.sort((function(e,i){return e[t]<i[t]?1:e[t]>i[t]?-1:0}));const i={},o=Math.floor(e.length/2);return i[o]=e[0],Array.from({length:o}).forEach(((t,r)=>{e[2*r+1]&&(i[o-1-r]=e[2*r+1]),e[2*r+2]&&(i[o+1+r]=e[2*r+2])})),Object.values(i)},d=e=>{let a=e.items.map((e=>((e,n)=>{for(var s in n||(n={}))i.call(n,s)&&r(e,s,n[s]);if(t)for(var s of t(n))o.call(n,s)&&r(e,s,n[s]);return e})({},e))),l=[],d=[],u=null,g={key:null,value:null},y=[],w=[],f=[];e.headerComponent&&(w.push({type:"header",component:e.headerComponent}),y.push(e.headerHeight));let v=0,E=a.slice(v,v+100);const C=e.width-2*e.padding-function(){const e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",document.body.appendChild(e);const t=document.createElement("div");e.appendChild(t);const i=e.offsetWidth-t.offsetWidth;return e.parentNode&&e.parentNode.removeChild(e),i}();for(let t=0;E.length>0&&w.length<=e.rowCount;t++){const i=t%e.rowRatios.length,o=e.rowRatios[i];let r=c(E,C,o,e.itemHeight,e.itemMargin);const n=r.reduce(((e,t)=>e+t.width),0),s=C/n;s<2&&r.length>1?r.some((e=>{e.width=Math.floor(e.width*s),e.height=Math.floor(e.height*s)})):f.length>0&&(r=m(r,f,n),w.pop(),y.pop()),e.sortKey&&(r=p(r,e.sortKey)),w.push(r),f=r;let l=[];r.forEach((t=>{l.push(t.height+e.itemMargin)})),y.push(Math.max(...l)),v+=r.length,E=a.slice(v,v+100)}e.footerComponent&&(w.push({type:"footer",component:e.footerComponent}),y.push(e.footerHeight)),l=w,d=y;if(e.scrollTo&&e.scrollTo.value!==g.value){const{key:t,value:i}=e.scrollTo;setTimeout((()=>{((t,i)=>{let o;l.some(((e,r)=>{if(void 0===e.type&&e.filter((e=>e[t]===i)).length>0)return o=r,!0}));let r=e.padding;d.some(((e,t)=>{if(t===o)return!0;r+=e}));const n=setInterval((()=>{if(u.firstElementChild.scrollTop>=r)return clearTimeout(n);u.firstElementChild.scrollTo(0,r)}),1);setTimeout((()=>clearTimeout(n)),1e3)})(t,i)}),100),g=JSON.parse(JSON.stringify(e.scrollTo))}return n.createElement("div",{className:e.className?e.className:"hiradumi",ref:e=>u=e},n.createElement(s,{width:e.width,height:e.height,itemCount:l.length,itemSize:e=>d[e],onScroll:t=>{if(!u)return;const i=u.firstElementChild;t.scrollTop=i.scrollTop,t.scrollBottom=i.scrollHeight-i.clientHeight-i.scrollTop,e.onScroll(t)},style:e.style},(t=>{const i=l[t.index],o=JSON.parse(JSON.stringify(t.style));return o.display="flex",o.justifyContent="space-between",void 0===i.type?(o.top=parseInt(t.style.top)+e.padding+"px",o.left=e.padding+"px",o.width=`calc(100% - ${2*e.padding}px)`,o.boxSizing="border-box",n.createElement("div",{className:"row",style:o,key:"row"},i.map(((t,i)=>n.createElement("div",{key:"item"+i,className:"item",id:t.id,style:{display:"inline-block",width:t.width+"px",height:t.height+"px",margin:e.itemMargin/2+"px"}},e.itemComponent?n.createElement(e.itemComponent,{item:t,margin:e.itemMargin,sortKey:e.sortKey}):n.createElement(h,{item:t,margin:e.itemMargin,sortKey:e.sortKey})))))):(o.top=parseInt(t.style.top)+e.padding+"px",o.marginTop=e.itemMargin/2,n.createElement("div",{className:"row",style:o},n.createElement(i.component,null)))})))};class u extends a.exports.Component{constructor(e){super(e)}setRowHeight(){let e=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach((t=>{""!==t.value?e.push(parseInt(t.value)):e.push(parseInt(t.placeholder))})),this.props.onChange({rowHeightList:e})}copy(){let e=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach((t=>{""!==t.value?e.push(t.value):e.push(parseFloat(t.placeholder))})),function(e){var t=document.createElement("div"),i=document.createElement("pre");i.style.webkitUserSelect="auto",i.style.userSelect="auto",t.appendChild(i).textContent=e;var o=t.style;o.position="fixed",o.right="200%",document.body.appendChild(t),document.getSelection().selectAllChildren(t);var r=document.execCommand("copy");document.body.removeChild(t)}(e.toString())}setSortKey(e){e.checked?this.props.onChange({sortKey:"term_popular_count"}):this.props.onChange({sortKey:null})}setRowFactors(){const e=[];Array.prototype.slice.call(document.querySelectorAll('input[type="number"]')).forEach((t=>{e.push(t.value)})),this.props.onChange({rowRatios:e})}render(){return n.createElement("div",{id:"settingsUI",style:{maxWidth:"1400px",margin:"0 auto",padding:"10px"}},n.createElement("div",null,n.createElement("label",{htmlFor:"itemHeight"},"itemHeight:"),n.createElement("input",{type:"range",id:"itemHeight",name:"width",min:"10",max:"600",value:this.props.itemHeight,onChange:e=>this.props.onChange({itemHeight:parseInt(e.target.value)})}),this.props.itemHeight," ",n.createElement("label",{htmlFor:"itemMargin"},"itemMargin:"),n.createElement("input",{type:"range",id:"itemMargin",name:"width",min:"0",max:"50",value:this.props.itemMargin,onChange:e=>this.props.onChange({itemMargin:parseInt(e.target.value)})}),this.props.itemMargin," ",n.createElement("label",{htmlFor:"rowCount"},"rowCount:"),n.createElement("input",{type:"range",id:"rowCount",name:"width",min:"1",max:"30",value:this.props.rowCount,onChange:e=>this.props.onChange({rowCount:parseInt(e.target.value)})}),this.props.rowCount,"  ",n.createElement("label",{htmlFor:"padding"},"padding:"),n.createElement("input",{type:"range",id:"padding",name:"width",min:"0",max:"50",value:this.props.padding,onChange:e=>this.props.onChange({padding:parseInt(e.target.value)})}),this.props.padding," ",n.createElement("label",{htmlFor:"sortKey"},"sortKey:"),n.createElement("input",{type:"checkbox",id:"sortKey",name:"sortKey",defaultChecked:!0,onChange:e=>this.setSortKey(e.target)})),n.createElement("br",null),n.createElement("div",null,n.createElement("label",null,"rowRatios:"),this.props.rowRatios&&this.props.rowRatios.map(((e,t)=>n.createElement("input",{type:"number",placeholder:String(e),value:String(e),step:"0.1",className:"rowHeight",key:t,onChange:this.setRowFactors.bind(this),style:{width:"3rem"}}))),n.createElement("button",{onClick:this.copy.bind(this)},"Copy")))}}const g=e=>{const t=e.item,i=(e.item.width-e.margin)/14,o=e.item.height/7;return n.createElement("a",{href:"https://calil.jp/book/"+e.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},t.cover?n.createElement("img",{src:t.cover,alt:t.title,"data-aspect":t.properties.aspect}):n.createElement("div",{className:"nocover"},n.createElement("div",{className:"bg"}),n.createElement("div",{className:"textCover"},t.height>100?n.createElement(n.Fragment,null,n.createElement("div",{className:"title",style:{fontSize:i+"px"}},t.title),n.createElement("div",{className:"author",style:{fontSize:.7*i+"px"}},t.author)):null)),e.sortKey&&t[e.sortKey]>0&&t.height>100?n.createElement("span",{className:"sortKey",style:{opacity:t[e.sortKey]/2+.1,fontSize:i+"px",width:o+"px",height:o+"px",right:o/4,bottom:o/4}},t[e.sortKey]):null)};class y extends a.exports.Component{constructor(e){super(e),this.state={items:e.items,itemHeight:200,width:100,height:0,padding:10,itemMargin:10,rowCount:1/0,sortKey:"term_popular_count",rowRatios:null,scrollTo:null,showHiradumi:!0}}componentDidMount(){document.body.clientWidth>767?this.setState({rowRatios:[1,.9,.8,.7]}):this.setState({rowRatios:[.97,.75,.65,.55]}),this.setState({width:window.innerWidth,height:window.innerHeight});const e=setInterval((()=>{this.settingUI&&(this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight}),clearInterval(e))}),100);if(window.addEventListener("resize",(()=>{this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight})})),location.hash){const e=location.hash.substr(1);this.setState({scrollTo:{key:"isbn",value:e}})}}onChange(e){"itemHeight"in e&&this.setState({showHiradumi:!1}),this.setState(e),"itemHeight"in e&&setTimeout((()=>{this.setState({showHiradumi:!0})}),100)}render(){return this.state.items?n.createElement("div",null,this.state.rowRatios?n.createElement(n.Fragment,null,n.createElement("div",{ref:e=>this.settingUI=e},n.createElement(u,{itemHeight:this.state.itemHeight,width:this.state.width,padding:this.state.padding,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,sortKey:this.state.sortKey,onChange:this.onChange.bind(this)})),n.createElement("div",{style:{width:"100%",margin:"0 auto"}},this.state.showHiradumi?n.createElement(d,{width:this.state.width,height:this.state.height,items:this.state.items,padding:this.state.padding,itemHeight:this.state.itemHeight,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,itemComponent:g,className:"hiradumi",sortKey:this.state.sortKey,onScroll:e=>{},headerComponent:w,headerHeight:50,footerComponent:f,footerHeight:50,style:{},scrollTo:this.state.scrollTo}):null)):null):null}}const w=()=>n.createElement("header",null,"header"),f=()=>n.createElement("footer",null,"footer");fetch("https://bookdata-fair.calil.dev/all.json").then((e=>e.json())).then((e=>{l.render(n.createElement(n.StrictMode,null,n.createElement(y,{items:e})),document.getElementById("root"))}));
