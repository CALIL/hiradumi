var R=Object.defineProperty;var S=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var x=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,b=(t,e)=>{for(var i in e||(e={}))I.call(e,i)&&x(t,i,e[i]);if(S)for(var i of S(e))N.call(e,i)&&x(t,i,e[i]);return t};import{R as n,V as T,r as H,a as k}from"./vendor.997f8905.js";const A=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerpolicy&&(o.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?o.credentials="include":l.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(l){if(l.ep)return;l.ep=!0;const o=i(l);fetch(l.href,o)}};A();const z=t=>{const e=t.item,i=(t.item.width-t.margin)/14,r=t.item.height/7;return n.createElement("a",{href:"https://calil.jp/book/"+t.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},e.cover?n.createElement("img",{src:e.cover,alt:e.title,"data-aspect":e.properties.aspect}):n.createElement("div",{className:"nocover"},n.createElement("div",{className:"bg"}),n.createElement("div",{className:"textCover"},e.height>100?n.createElement(n.Fragment,null,n.createElement("div",{className:"title",style:{fontSize:i+"px"}},e.title),n.createElement("div",{className:"author",style:{fontSize:i*.7+"px"}},e.author)):null)),t.sortKey&&e[t.sortKey]>0&&e.height>100?n.createElement("span",{className:"sortKey",style:{opacity:e[t.sortKey]/2+.1,fontSize:i+"px",width:r+"px",height:r+"px",right:r/4,bottom:r/4}},e[t.sortKey]):null)};function F(){const t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",document.body.appendChild(t);const e=document.createElement("div");t.appendChild(e);const i=t.offsetWidth-e.offsetWidth;return t.parentNode&&t.parentNode.removeChild(t),i}const W=(t,e,i,r,l)=>{const o=[];let a=0;const g=r*i;return t.some(m=>{const E=m.properties&&m.properties.aspect?m.properties.aspect:.666666,w=Math.floor(g*E)+l;if(a+w>e)return!0;m.height=g,m.width=w,o.push(m),a+=w}),o},O=(t,e,i)=>{const r=e.reduce((a,g)=>a+g.width,0),l=r/(r+i);e.some(a=>{a.width=Math.floor(a.width*l),a.height=Math.floor(a.height*l)});const o=e[0].height/t[0].height;return t.some(a=>{a.width=Math.floor(a.width*o),a.height=Math.floor(a.height*o)}),e.concat(t)},U=(t,e)=>{e&&t.sort(function(l,o){return l[e]<o[e]?1:l[e]>o[e]?-1:0});const i={},r=Math.floor(t.length/2);return i[r]=t[0],Array.from({length:r}).forEach((l,o)=>{t[o*2+1]&&(i[r-1-o]=t[o*2+1]),t[o*2+2]&&(i[r+1+o]=t[o*2+2])}),Object.values(i)},j=t=>{if(t.items===void 0||t.items===null||t.items.length===0)return null;let e=t.items.map(s=>b({},s)),i=[],r=null,l={key:null,value:null},o=[],a=[],g=[];t.headerComponent&&(a.push({type:"header",component:t.headerComponent}),o.push(t.headerHeight));let m=0,v=e.slice(m,m+100);const E=t.width-t.padding*2-F();for(let s=0;v.length>0&&a.length<=t.rowCount;s++){const c=s%t.rowRatios.length,d=t.rowRatios[c];let h=W(v,E,d,t.itemHeight,t.itemMargin);const y=h.reduce((u,M)=>u+M.width,0),p=E/y;p<2&&h.length>1?h.some(u=>{u.width=Math.floor(u.width*p),u.height=Math.floor(u.height*p)}):g.length>0&&(h=O(h,g,y),a.pop(),o.pop()),t.sortKey&&(h=U(h,t.sortKey)),a.push(h),g=h;let f=[];h.forEach(u=>{f.push(u.height+t.itemMargin)}),o.push(Math.max(...f)),m+=h.length,v=e.slice(m,m+100)}t.footerComponent&&(a.push({type:"footer",component:t.footerComponent}),o.push(t.footerHeight)),i=a;const w=(s,c)=>{let d;i.some((p,f)=>{if(typeof p.type=="undefined"&&p.filter(u=>u[s]===c).length>0)return d=f,!0});let h=t.padding;o.some((p,f)=>{if(f===d)return!0;h+=p});const y=setInterval(()=>{if(r.firstElementChild.scrollTop>=h)return clearTimeout(y);r.firstElementChild.scrollTo(0,h)},1);setTimeout(()=>clearTimeout(y),1e3)};if(t.scrollTo&&t.scrollTo.value!==l.value){const{key:s,value:c}=t.scrollTo;setTimeout(()=>{w(s,c)},100),l=JSON.parse(JSON.stringify(t.scrollTo))}let C=0;o.some((s,c)=>{C+=s});const K=C/i.length;return n.createElement("div",{className:t.className?t.className:"hiradumi",ref:s=>r=s},n.createElement(T,{width:t.width,height:t.height,itemCount:i.length,itemSize:s=>o[s],estimatedItemSize:K,onScroll:s=>{if(!r)return;const c=r.firstElementChild;s.scrollTop=c.scrollTop,s.scrollBottom=c.scrollHeight-c.clientHeight-c.scrollTop,t.onScroll(s)},style:t.innerStyle},s=>{const c=i[s.index],d=JSON.parse(JSON.stringify(s.style));return d.display="flex",d.justifyContent="space-between",typeof c.type=="undefined"?(d.top=parseInt(s.style.top)+t.padding+"px",d.left=t.padding+"px",d.width=`calc(100% - ${t.padding*2}px)`,d.boxSizing="border-box",n.createElement("div",{className:"row",style:d,key:"row"},c.map((h,y)=>n.createElement("div",{key:"item"+y,className:"item",id:h.id,style:{display:"inline-block",width:h.width+"px",height:h.height+"px",margin:t.itemMargin/2+"px"}},(()=>t.itemComponent?n.createElement(t.itemComponent,{item:h,margin:t.itemMargin,sortKey:t.sortKey}):n.createElement(z,{item:h,margin:t.itemMargin,sortKey:t.sortKey}))())))):(d.top=parseInt(s.style.top)+t.padding+"px",d.marginTop=t.itemMargin/2,n.createElement("div",{className:"row",style:d},n.createElement(c.component,null)))}))};function _(t){var e=document.createElement("div"),i=document.createElement("pre");i.style.webkitUserSelect="auto",i.style.userSelect="auto",e.appendChild(i).textContent=t;var r=e.style;r.position="fixed",r.right="200%",document.body.appendChild(e),document.getSelection().selectAllChildren(e);var l=document.execCommand("copy");return document.body.removeChild(e),l}class D extends H.exports.Component{constructor(e){super(e)}setRowHeight(){let e=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach(i=>{i.value!==""?e.push(parseInt(i.value)):e.push(parseInt(i.placeholder))}),this.props.onChange({rowHeightList:e})}copy(){let e=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach(i=>{i.value!==""?e.push(i.value):e.push(parseFloat(i.placeholder))}),_(e.toString())}setSortKey(e){e.checked?this.props.onChange({sortKey:"term_popular_count"}):this.props.onChange({sortKey:null})}setRowFactors(){const e=[];Array.prototype.slice.call(document.querySelectorAll('input[type="number"]')).forEach(i=>{e.push(i.value)}),this.props.onChange({rowRatios:e})}render(){return n.createElement("div",{id:"settingsUI",style:{maxWidth:"1400px",margin:"0 auto",padding:"10px"}},n.createElement("div",null,n.createElement("label",{htmlFor:"itemHeight"},"itemHeight:"),n.createElement("input",{type:"range",id:"itemHeight",name:"width",min:"10",max:"600",value:this.props.itemHeight,onChange:e=>this.props.onChange({itemHeight:parseInt(e.target.value)})}),this.props.itemHeight,"\xA0",n.createElement("label",{htmlFor:"itemMargin"},"itemMargin:"),n.createElement("input",{type:"range",id:"itemMargin",name:"width",min:"0",max:"50",value:this.props.itemMargin,onChange:e=>this.props.onChange({itemMargin:parseInt(e.target.value)})}),this.props.itemMargin,"\xA0",n.createElement("label",{htmlFor:"rowCount"},"rowCount:"),n.createElement("input",{type:"range",id:"rowCount",name:"width",min:"1",max:"30",value:this.props.rowCount,onChange:e=>this.props.onChange({rowCount:parseInt(e.target.value)})}),this.props.rowCount,"\xA0\xA0",n.createElement("label",{htmlFor:"padding"},"padding:"),n.createElement("input",{type:"range",id:"padding",name:"width",min:"0",max:"50",value:this.props.padding,onChange:e=>this.props.onChange({padding:parseInt(e.target.value)})}),this.props.padding,"\xA0",n.createElement("label",{htmlFor:"sortKey"},"sortKey:"),n.createElement("input",{type:"checkbox",id:"sortKey",name:"sortKey",defaultChecked:!0,onChange:e=>this.setSortKey(e.target)})),n.createElement("br",null),n.createElement("div",null,n.createElement("label",null,"rowRatios:"),this.props.rowRatios&&this.props.rowRatios.map((e,i)=>n.createElement("input",{type:"number",placeholder:String(e),value:String(e),step:"0.1",className:"rowHeight",key:i,onChange:this.setRowFactors.bind(this),style:{width:"3rem"}})),n.createElement("button",{onClick:this.copy.bind(this)},"Copy")))}}const L=t=>{const e=t.item,i=(t.item.width-t.margin)/14,r=t.item.height/7;return n.createElement("a",{href:"https://calil.jp/book/"+t.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},e.cover?n.createElement("img",{src:e.cover,alt:e.title,"data-aspect":e.properties.aspect}):n.createElement("div",{className:"nocover"},n.createElement("div",{className:"bg"}),n.createElement("div",{className:"textCover"},e.height>100?n.createElement(n.Fragment,null,n.createElement("div",{className:"title",style:{fontSize:i+"px"}},e.title),n.createElement("div",{className:"author",style:{fontSize:i*.7+"px"}},e.author)):null)),t.sortKey&&e[t.sortKey]>0&&e.height>100?n.createElement("span",{className:"sortKey",style:{opacity:e[t.sortKey]/2+.1,fontSize:i+"px",width:r+"px",height:r+"px",right:r/4,bottom:r/4}},e[t.sortKey]):null)};class P extends H.exports.Component{constructor(e){super(e);this.state={items:[],itemHeight:200,width:100,height:0,padding:10,itemMargin:10,rowCount:1/0,sortKey:"term_popular_count",rowRatios:null,scrollTo:null,showHiradumi:!0}}componentDidMount(){document.body.clientWidth>767?this.setState({rowRatios:[1,.9,.8,.7]}):this.setState({rowRatios:[.97,.75,.65,.55]}),this.setState({width:window.innerWidth,height:window.innerHeight});const e=setInterval(()=>{this.settingUI&&(this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight}),clearInterval(e))},100);if(window.addEventListener("resize",()=>{this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight})}),location.hash){const i=location.hash.substr(1);this.setState({scrollTo:{key:"isbn",value:i}})}fetch("https://bookdata-fair.calil.dev/all.json").then(i=>i.json()).then(i=>{this.setState({items:i})})}onChange(e){"itemHeight"in e&&this.setState({showHiradumi:!1}),this.setState(e),"itemHeight"in e&&setTimeout(()=>{this.setState({showHiradumi:!0})},100)}render(){return console.log(this.state.items),n.createElement("div",null,this.state.rowRatios?n.createElement(n.Fragment,null,n.createElement("div",{ref:e=>this.settingUI=e},n.createElement(D,{itemHeight:this.state.itemHeight,width:this.state.width,padding:this.state.padding,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,sortKey:this.state.sortKey,onChange:this.onChange.bind(this)})),n.createElement("div",{style:{width:"100%",margin:"0 auto"}},this.state.showHiradumi?n.createElement(j,{width:this.state.width,height:this.state.height,items:this.state.items,padding:this.state.padding,itemHeight:this.state.itemHeight,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,itemComponent:L,className:"hiradumi",sortKey:this.state.sortKey,onScroll:e=>{},headerComponent:q,headerHeight:50,footerComponent:J,footerHeight:50,innerStyle:{},scrollTo:this.state.scrollTo}):null)):null)}}const q=()=>n.createElement("header",null,"header"),J=()=>n.createElement("footer",null,"footer");k.render(n.createElement(n.StrictMode,null,n.createElement(P,null)),document.getElementById("root"));
