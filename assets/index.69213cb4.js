var t=Object.defineProperty,e=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s,r=(t,r)=>{for(var n in r||(r={}))i.call(r,n)&&o(t,n,r[n]);if(e)for(var n of e(r))s.call(r,n)&&o(t,n,r[n]);return t};"undefined"!=typeof require&&require;import{r as n,R as a,V as l,a as h}from"./vendor.997f8905.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class p extends n.exports.Component{constructor(t){super(t)}render(){const t=this.props.item,e=(this.props.item.width-this.props.margin)/14;return this.props.item.height,a.createElement("a",{href:"https://calil.jp/book/"+this.props.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},t.cover?a.createElement("img",{src:t.cover,alt:t.title,"data-aspect":t.properties.aspect}):a.createElement("div",{className:"nocover"},a.createElement("div",{className:"bg"}),a.createElement("div",{className:"textCover"},t.height>100?a.createElement(a.Fragment,null,a.createElement("div",{className:"title",style:{fontSize:e+"px"}},t.title),a.createElement("div",{className:"author",style:{fontSize:.7*e+"px"}},t.author)):null)))}}class c extends a.Component{constructor(t){super(t),this.state={items:t.items.map((t=>r({},t))),rows:[],rowHeights:[]},this.hiradumi=null,this.prevScrollTo={key:null,value:null}}componentDidMount(){this.setRowData(),this.checkScrollTo()}shouldComponentUpdate(){return this.state.items=this.props.items.map((t=>r({},t))),this.setRowData(),this.checkScrollTo(),!0}checkScrollTo(){if(this.props.scrollTo&&this.props.scrollTo.value!==this.prevScrollTo.value){const{key:t,value:e}=this.props.scrollTo;setTimeout((()=>{this.scrollTo(t,e)}),100),this.prevScrollTo=JSON.parse(JSON.stringify(this.props.scrollTo))}}scrollTo(t,e){let i;this.state.rows.forEach(((s,o)=>{void 0===s.type&&s.filter((i=>i[t]===e)).length>0&&(i=o)}));let s=this.props.padding;this.state.rowHeights.some(((t,e)=>{if(e===i)return!0;s+=t}));const o=setInterval((()=>{if(this.hiradumi.firstElementChild.scrollTop>=s)return clearTimeout(o);this.hiradumi.firstElementChild.scrollTo(0,s)}),1);setTimeout((()=>{clearTimeout(o)}),1e3)}putItem(t,e,i){const s=[];let o=0;const r=this.props.itemHeight*i;return t.some((t=>{const i=t.properties&&t.properties.aspect?t.properties.aspect:.666666,n=Math.floor(r*i)+this.props.itemMargin;if(o+n>e)return!0;t.height=r,t.width=n,s.push(t),o+=n})),s}pushPreviousRow(t,e,i){const s=e.reduce(((t,e)=>t+e.width),0),o=s/(s+i);e.some((t=>{t.width=Math.floor(t.width*o),t.height=Math.floor(t.height*o)}));const r=e[0].height/t[0].height;return t.some((t=>{t.width=Math.floor(t.width*r),t.height=Math.floor(t.height*r)})),e.concat(t)}sortCenter(t){const e=this.props.sortKey;e&&t.sort((function(t,i){return t[e]<i[e]?1:t[e]>i[e]?-1:0}));const i={},s=Math.floor(t.length/2);return i[s]=t[0],Array.from({length:s}).forEach(((e,o)=>{t[2*o+1]&&(i[s-1-o]=t[2*o+1]),t[2*o+2]&&(i[s+1+o]=t[2*o+2])})),Object.values(i)}setRowData(){this.state.rowHeights=[];let t=[],e=[];this.props.headerComponent&&(t.push({type:"header",component:this.props.headerComponent}),this.state.rowHeights.push(this.props.headerHeight));let i=0,s=this.state.items.slice(i,i+100);const o=this.props.width-2*this.props.padding-function(){const t=document.createElement("div");t.style.visibility="hidden",t.style.overflow="scroll",document.body.appendChild(t);const e=document.createElement("div");t.appendChild(e);const i=t.offsetWidth-e.offsetWidth;return t.parentNode&&t.parentNode.removeChild(t),i}();for(let r=0;s.length>0&&t.length<this.props.rowCount;r++){const n=r%this.props.rowRatios.length,a=this.props.rowRatios[n];let l=this.putItem(s,o,a);const h=l.reduce(((t,e)=>t+e.width),0),p=o/h;p<2&&l.length>1?l.some((t=>{t.width=Math.floor(t.width*p),t.height=Math.floor(t.height*p)})):e.length>0&&(l=this.pushPreviousRow(l,e,h),t.pop(),this.state.rowHeights.pop()),this.props.sortKey&&(l=this.sortCenter(l)),t.push(l),e=l;let c=[];l.forEach((t=>{c.push(t.height+this.props.itemMargin)})),this.state.rowHeights.push(Math.max(...c)),i+=l.length,s=this.state.items.slice(i,i+100)}this.props.footerComponent&&(t.push({type:"footer",component:this.props.footerComponent}),this.state.rowHeights.push(this.props.footerHeight)),this.state.rows=t}onScroll(t){if(!this.hiradumi)return;const e=this.hiradumi.firstElementChild;t.scrollTop=e.scrollTop,t.scrollBottom=e.scrollHeight-e.clientHeight-e.scrollTop,this.props.onScroll(t)}render(){return a.createElement("div",{className:this.props.className?this.props.className:"hiradumi",ref:t=>this.hiradumi=t},a.createElement(l,{width:this.props.width,height:this.props.height,itemCount:this.state.rows.length,itemSize:t=>this.state.rowHeights[t],onScroll:this.onScroll.bind(this),style:this.props.style},(t=>{const e=this.state.rows[t.index];return this.renderRow(e,t.style)})))}renderRow(t,e){const i=JSON.parse(JSON.stringify(e));return i.display="flex",i.justifyContent="space-between",void 0===t.type?(i.top=parseInt(e.top)+this.props.padding+"px",i.left=this.props.padding+"px",i.width=`calc(100% - ${2*this.props.padding}px)`,i.boxSizing="border-box",a.createElement("div",{className:"row",style:i},t.map((t=>a.createElement("div",{className:"item",id:t.id,style:{display:"inline-block",width:t.width+"px",height:t.height+"px",margin:this.props.itemMargin/2+"px"}},(()=>this.props.itemComponent?a.createElement(this.props.itemComponent,{item:t,margin:this.props.itemMargin,sortKey:this.props.sortKey}):a.createElement(p,{item:t,margin:this.props.itemMargin,sortKey:this.props.sortKey}))()))))):(i.top=parseInt(e.top)+this.props.padding+"px",i.marginTop=this.props.itemMargin/2,a.createElement("div",{className:"row",style:i},a.createElement(t.component,null)))}}class m extends n.exports.Component{constructor(t){super(t)}setRowHeight(){let t=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach((e=>{""!==e.value?t.push(parseInt(e.value)):t.push(parseInt(e.placeholder))})),this.props.onChange({rowHeightList:t})}copy(){let t=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach((e=>{""!==e.value?t.push(e.value):t.push(parseFloat(e.placeholder))})),function(t){var e=document.createElement("div"),i=document.createElement("pre");i.style.webkitUserSelect="auto",i.style.userSelect="auto",e.appendChild(i).textContent=t;var s=e.style;s.position="fixed",s.right="200%",document.body.appendChild(e),document.getSelection().selectAllChildren(e);var o=document.execCommand("copy");document.body.removeChild(e)}(t.toString())}setSortKey(t){t.checked?this.props.onChange({sortKey:"term_popular_count"}):this.props.onChange({sortKey:null})}setRowFactors(){const t=[];Array.prototype.slice.call(document.querySelectorAll('input[type="number"]')).forEach((e=>{t.push(e.value)})),this.props.onChange({rowRatios:t})}render(){return a.createElement("div",{id:"settingsUI",style:{maxWidth:"1400px",margin:"0 auto",padding:"10px"}},a.createElement("div",null,a.createElement("label",{htmlFor:"itemHeight"},"itemHeight:"),a.createElement("input",{type:"range",id:"itemHeight",name:"width",min:"10",max:"600",value:this.props.itemHeight,onChange:t=>this.props.onChange({itemHeight:parseInt(t.target.value)})}),this.props.itemHeight," ",a.createElement("label",{htmlFor:"itemMargin"},"itemMargin:"),a.createElement("input",{type:"range",id:"itemMargin",name:"width",min:"0",max:"50",value:this.props.itemMargin,onChange:t=>this.props.onChange({itemMargin:parseInt(t.target.value)})}),this.props.itemMargin," ",a.createElement("label",{htmlFor:"rowCount"},"rowCount:"),a.createElement("input",{type:"range",id:"rowCount",name:"width",min:"1",max:"30",value:this.props.rowCount,onChange:t=>this.props.onChange({rowCount:parseInt(t.target.value)})}),this.props.rowCount,"  ",a.createElement("label",{htmlFor:"padding"},"padding:"),a.createElement("input",{type:"range",id:"padding",name:"width",min:"0",max:"50",value:this.props.padding,onChange:t=>this.props.onChange({padding:parseInt(t.target.value)})}),this.props.padding," ",a.createElement("label",{htmlFor:"sortKey"},"sortKey:"),a.createElement("input",{type:"checkbox",id:"sortKey",name:"sortKey",defaultChecked:!0,onChange:t=>this.setSortKey(t.target)})),a.createElement("br",null),a.createElement("div",null,a.createElement("label",null,"rowRatios:"),this.props.rowRatios&&this.props.rowRatios.map(((t,e)=>a.createElement("input",{type:"number",placeholder:String(t),value:String(t),step:"0.1",className:"rowHeight",key:e,onChange:this.setRowFactors.bind(this),style:{width:"3rem"}}))),a.createElement("button",{onClick:this.copy.bind(this)},"Copy")))}}class d extends n.exports.Component{constructor(t){super(t)}render(){const t=this.props.item,e=(this.props.item.width-this.props.margin)/14;return this.props.item.height,a.createElement("a",{href:"https://calil.jp/book/"+this.props.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},t.cover?a.createElement("img",{src:t.cover,alt:t.title,"data-aspect":t.properties.aspect}):a.createElement("div",{className:"nocover"},a.createElement("div",{className:"bg"}),a.createElement("div",{className:"textCover"},t.height>100?a.createElement(a.Fragment,null,a.createElement("div",{className:"title",style:{fontSize:e+"px"}},t.title),a.createElement("div",{className:"author",style:{fontSize:.7*e+"px"}},t.author)):null)))}}class u extends n.exports.Component{constructor(t){super(t),this.state={items:t.items,itemHeight:200,width:100,height:0,padding:10,itemMargin:10,rowCount:1/0,sortKey:"term_popular_count",rowRatios:null,scrollTo:null}}componentDidMount(){document.body.clientWidth>767?this.setState({rowRatios:[1,.9,.8,.7]}):this.setState({rowRatios:[.97,.75,.65,.55]}),this.setState({width:window.innerWidth,height:window.innerHeight});const t=setInterval((()=>{this.settingUI&&(this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight}),clearInterval(t))}),100);if(window.addEventListener("resize",(()=>{this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight})})),location.hash){const t=location.hash.substr(1);this.setState({scrollTo:{key:"isbn",value:t}})}}onChange(t){this.setState(t)}render(){return this.state.items?a.createElement("div",null,this.state.rowRatios?a.createElement(a.Fragment,null,a.createElement("div",{ref:t=>this.settingUI=t},a.createElement(m,{itemHeight:this.state.itemHeight,width:this.state.width,padding:this.state.padding,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,sortKey:this.state.sortKey,onChange:this.onChange.bind(this)})),a.createElement("div",{style:{width:"100%",margin:"0 auto"}},a.createElement(c,{width:this.state.width,height:this.state.height,items:this.state.items,padding:this.state.padding,itemHeight:this.state.itemHeight,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,itemComponent:d,className:"hiradumi",sortKey:this.state.sortKey,onScroll:t=>{},headerComponent:g,headerHeight:50,footerComponent:w,footerHeight:50,style:{},scrollTo:this.state.scrollTo}))):null):null}}const g=()=>a.createElement("header",null,"header"),w=()=>a.createElement("footer",null,"footer");fetch("https://bookdata-fair.calil.dev/all.json").then((t=>t.json())).then((t=>{h.render(a.createElement(a.StrictMode,null,a.createElement(u,{items:t})),document.getElementById("root"))}));
