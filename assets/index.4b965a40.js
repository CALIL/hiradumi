import{R as e,V as t,r as i,a as o}from"./vendor.997f8905.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const n=t=>{const i=t.item,o=(t.item.width-t.margin)/14,n=t.item.height/7;return e.createElement("a",{href:"https://calil.jp/book/"+t.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},i.cover?e.createElement("img",{src:i.cover,alt:i.title,"data-aspect":i.properties.aspect}):e.createElement("div",{className:"nocover"},e.createElement("div",{className:"bg"}),e.createElement("div",{className:"textCover"},i.height>100?e.createElement(e.Fragment,null,e.createElement("div",{className:"title",style:{fontSize:o+"px"}},i.title),e.createElement("div",{className:"author",style:{fontSize:.7*o+"px"}},i.author)):null)),t.sortKey&&i[t.sortKey]>0&&i.height>100?e.createElement("span",{className:"sortKey",style:{opacity:i[t.sortKey]/2+.1,fontSize:o+"px",width:n+"px",height:n+"px",right:n/4,bottom:n/4}},i[t.sortKey]):null)};const r=(e,t,i,o,n)=>{const r=[];let s=0;const a=o*i;return e.some((e=>{const i=e.properties&&e.properties.aspect?e.properties.aspect:.666666,o=Math.floor(a*i)+n;if(s+o>t)return!0;e.height=a,e.width=o,r.push(e),s+=o})),r},s=(e,t,i)=>{const o=t.reduce(((e,t)=>e+t.width),0),n=o/(o+i);t.some((e=>{e.width=Math.floor(e.width*n),e.height=Math.floor(e.height*n)}));const r=t[0].height/e[0].height;return e.some((e=>{e.width=Math.floor(e.width*r),e.height=Math.floor(e.height*r)})),t.concat(e)},a=(e,t)=>{t&&e.sort((function(e,i){return e[t]<i[t]?1:e[t]>i[t]?-1:0}));const i={},o=Math.floor(e.length/2);return i[o]=e[0],Array.from({length:o}).forEach(((t,n)=>{e[2*n+1]&&(i[o-1-n]=e[2*n+1]),e[2*n+2]&&(i[o+1+n]=e[2*n+2])})),Object.values(i)},l=i=>{let o=i.items.map((e=>Object.assign({},e))),l=[],h=[],c=null,m={key:null,value:null},p=[],d=[],g=[];i.headerComponent&&(d.push({type:"header",component:i.headerComponent}),p.push(i.headerHeight));let u=0,y=o.slice(u,u+100);const w=i.width-2*i.padding-function(){const e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",document.body.appendChild(e);const t=document.createElement("div");e.appendChild(t);const i=e.offsetWidth-t.offsetWidth;return e.parentNode&&e.parentNode.removeChild(e),i}();for(let e=0;y.length>0&&d.length<=i.rowCount;e++){const t=e%i.rowRatios.length,n=i.rowRatios[t];let l=r(y,w,n,i.itemHeight,i.itemMargin);const h=l.reduce(((e,t)=>e+t.width),0),c=w/h;c<2&&l.length>1?l.some((e=>{e.width=Math.floor(e.width*c),e.height=Math.floor(e.height*c)})):g.length>0&&(l=s(l,g,h),d.pop(),p.pop()),i.sortKey&&(l=a(l,i.sortKey)),d.push(l),g=l;let m=[];l.forEach((e=>{m.push(e.height+i.itemMargin)})),p.push(Math.max(...m)),u+=l.length,y=o.slice(u,u+100)}i.footerComponent&&(d.push({type:"footer",component:i.footerComponent}),p.push(i.footerHeight)),l=d,h=p;if(i.scrollTo&&i.scrollTo.value!==m.value){const{key:e,value:t}=i.scrollTo;setTimeout((()=>{((e,t)=>{let o;l.some(((i,n)=>{if(void 0===i.type&&i.filter((i=>i[e]===t)).length>0)return o=n,!0}));let n=i.padding;h.some(((e,t)=>{if(t===o)return!0;n+=e}));const r=setInterval((()=>{if(c.firstElementChild.scrollTop>=n)return clearTimeout(r);c.firstElementChild.scrollTo(0,n)}),1);setTimeout((()=>clearTimeout(r)),1e3)})(e,t)}),100),m=JSON.parse(JSON.stringify(i.scrollTo))}return e.createElement("div",{className:i.className?i.className:"hiradumi",ref:e=>c=e},e.createElement(t,{width:i.width,height:i.height,itemCount:l.length,itemSize:e=>h[e],onScroll:e=>{if(!c)return;const t=c.firstElementChild;e.scrollTop=t.scrollTop,e.scrollBottom=t.scrollHeight-t.clientHeight-t.scrollTop,i.onScroll(e)},style:i.innerStyle},(t=>{const o=l[t.index],r=JSON.parse(JSON.stringify(t.style));return r.display="flex",r.justifyContent="space-between",void 0===o.type?(r.top=parseInt(t.style.top)+i.padding+"px",r.left=i.padding+"px",r.width=`calc(100% - ${2*i.padding}px)`,r.boxSizing="border-box",e.createElement("div",{className:"row",style:r,key:"row"},o.map(((t,o)=>e.createElement("div",{key:"item"+o,className:"item",id:t.id,style:{display:"inline-block",width:t.width+"px",height:t.height+"px",margin:i.itemMargin/2+"px"}},i.itemComponent?e.createElement(i.itemComponent,{item:t,margin:i.itemMargin,sortKey:i.sortKey}):e.createElement(n,{item:t,margin:i.itemMargin,sortKey:i.sortKey})))))):(r.top=parseInt(t.style.top)+i.padding+"px",r.marginTop=i.itemMargin/2,e.createElement("div",{className:"row",style:r},e.createElement(o.component,null)))})))};class h extends i.exports.Component{constructor(e){super(e)}setRowHeight(){let e=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach((t=>{""!==t.value?e.push(parseInt(t.value)):e.push(parseInt(t.placeholder))})),this.props.onChange({rowHeightList:e})}copy(){let e=[];Array.prototype.slice.call(document.querySelectorAll(".rowHeight")).forEach((t=>{""!==t.value?e.push(t.value):e.push(parseFloat(t.placeholder))})),function(e){var t=document.createElement("div"),i=document.createElement("pre");i.style.webkitUserSelect="auto",i.style.userSelect="auto",t.appendChild(i).textContent=e;var o=t.style;o.position="fixed",o.right="200%",document.body.appendChild(t),document.getSelection().selectAllChildren(t);var n=document.execCommand("copy");document.body.removeChild(t)}(e.toString())}setSortKey(e){e.checked?this.props.onChange({sortKey:"term_popular_count"}):this.props.onChange({sortKey:null})}setRowFactors(){const e=[];Array.prototype.slice.call(document.querySelectorAll('input[type="number"]')).forEach((t=>{e.push(t.value)})),this.props.onChange({rowRatios:e})}render(){return e.createElement("div",{id:"settingsUI",style:{maxWidth:"1400px",margin:"0 auto",padding:"10px"}},e.createElement("div",null,e.createElement("label",{htmlFor:"itemHeight"},"itemHeight:"),e.createElement("input",{type:"range",id:"itemHeight",name:"width",min:"10",max:"600",value:this.props.itemHeight,onChange:e=>this.props.onChange({itemHeight:parseInt(e.target.value)})}),this.props.itemHeight," ",e.createElement("label",{htmlFor:"itemMargin"},"itemMargin:"),e.createElement("input",{type:"range",id:"itemMargin",name:"width",min:"0",max:"50",value:this.props.itemMargin,onChange:e=>this.props.onChange({itemMargin:parseInt(e.target.value)})}),this.props.itemMargin," ",e.createElement("label",{htmlFor:"rowCount"},"rowCount:"),e.createElement("input",{type:"range",id:"rowCount",name:"width",min:"1",max:"30",value:this.props.rowCount,onChange:e=>this.props.onChange({rowCount:parseInt(e.target.value)})}),this.props.rowCount,"  ",e.createElement("label",{htmlFor:"padding"},"padding:"),e.createElement("input",{type:"range",id:"padding",name:"width",min:"0",max:"50",value:this.props.padding,onChange:e=>this.props.onChange({padding:parseInt(e.target.value)})}),this.props.padding," ",e.createElement("label",{htmlFor:"sortKey"},"sortKey:"),e.createElement("input",{type:"checkbox",id:"sortKey",name:"sortKey",defaultChecked:!0,onChange:e=>this.setSortKey(e.target)})),e.createElement("br",null),e.createElement("div",null,e.createElement("label",null,"rowRatios:"),this.props.rowRatios&&this.props.rowRatios.map(((t,i)=>e.createElement("input",{type:"number",placeholder:String(t),value:String(t),step:"0.1",className:"rowHeight",key:i,onChange:this.setRowFactors.bind(this),style:{width:"3rem"}}))),e.createElement("button",{onClick:this.copy.bind(this)},"Copy")))}}const c=t=>{const i=t.item,o=(t.item.width-t.margin)/14,n=t.item.height/7;return e.createElement("a",{href:"https://calil.jp/book/"+t.item.isbn,target:"_blank",style:{display:"inline-block",width:"100%",height:"100%"}},i.cover?e.createElement("img",{src:i.cover,alt:i.title,"data-aspect":i.properties.aspect}):e.createElement("div",{className:"nocover"},e.createElement("div",{className:"bg"}),e.createElement("div",{className:"textCover"},i.height>100?e.createElement(e.Fragment,null,e.createElement("div",{className:"title",style:{fontSize:o+"px"}},i.title),e.createElement("div",{className:"author",style:{fontSize:.7*o+"px"}},i.author)):null)),t.sortKey&&i[t.sortKey]>0&&i.height>100?e.createElement("span",{className:"sortKey",style:{opacity:i[t.sortKey]/2+.1,fontSize:o+"px",width:n+"px",height:n+"px",right:n/4,bottom:n/4}},i[t.sortKey]):null)};class m extends i.exports.Component{constructor(e){super(e),this.state={items:e.items,itemHeight:200,width:100,height:0,padding:10,itemMargin:10,rowCount:1/0,sortKey:"term_popular_count",rowRatios:null,scrollTo:null,showHiradumi:!0}}componentDidMount(){document.body.clientWidth>767?this.setState({rowRatios:[1,.9,.8,.7]}):this.setState({rowRatios:[.97,.75,.65,.55]}),this.setState({width:window.innerWidth,height:window.innerHeight});const e=setInterval((()=>{this.settingUI&&(this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight}),clearInterval(e))}),100);if(window.addEventListener("resize",(()=>{this.setState({width:window.innerWidth,height:window.innerHeight-this.settingUI.clientHeight})})),location.hash){const e=location.hash.substr(1);this.setState({scrollTo:{key:"isbn",value:e}})}}onChange(e){"itemHeight"in e&&this.setState({showHiradumi:!1}),this.setState(e),"itemHeight"in e&&setTimeout((()=>{this.setState({showHiradumi:!0})}),100)}render(){return this.state.items?e.createElement("div",null,this.state.rowRatios?e.createElement(e.Fragment,null,e.createElement("div",{ref:e=>this.settingUI=e},e.createElement(h,{itemHeight:this.state.itemHeight,width:this.state.width,padding:this.state.padding,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,sortKey:this.state.sortKey,onChange:this.onChange.bind(this)})),e.createElement("div",{style:{width:"100%",margin:"0 auto"}},this.state.showHiradumi?e.createElement(l,{width:this.state.width,height:this.state.height,items:this.state.items,padding:this.state.padding,itemHeight:this.state.itemHeight,itemMargin:this.state.itemMargin,rowCount:this.state.rowCount,rowRatios:this.state.rowRatios,itemComponent:c,className:"hiradumi",sortKey:this.state.sortKey,onScroll:e=>{},headerComponent:p,headerHeight:50,footerComponent:d,footerHeight:50,innerStyle:{},scrollTo:this.state.scrollTo}):null)):null):null}}const p=()=>e.createElement("header",null,"header"),d=()=>e.createElement("footer",null,"footer");fetch("https://bookdata-fair.calil.dev/all.json").then((e=>e.json())).then((t=>{o.render(e.createElement(e.StrictMode,null,e.createElement(m,{items:t})),document.getElementById("root"))}));
